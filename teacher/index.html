<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PH·∫¶N 1 </title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { 
      font-family: Arial; 
      display: flex; 
      justify-content: center; /* CƒÉn gi·ªØa to√†n b·ªô trang */
      align-items: flex-start;
      padding-top: 30px;
      gap: 40px; /* Kho·∫£ng c√°ch gi·ªØa c√°c ph·∫ßn t·ª≠ */
    }
    #questionButtons {
      display: flex;
      flex-direction: column;
      gap: 15px; /* Kho·∫£ng c√°ch gi·ªØa c√°c n√∫t c√¢u h·ªèi */
      width: 150px; /* Chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·ªôt c√¢u h·ªèi */
    }
    button {
      font-size: 18px; 
      margin: 5px; 
      padding: 10px 20px;
      background-color: #4CAF50; 
      color: white; 
      border: none; 
      border-radius: 6px; 
      cursor: pointer;
    }
    button.selected {
      background-color: #ff9800;
    }
    table { 
      border-collapse: collapse; 
      width: 100%; /* Chi·∫øm to√†n b·ªô chi·ªÅu r·ªông c·ªßa ph·∫ßn b√™n ph·∫£i */
    }
    th, td { 
      border: 1px solid #ccc; 
      padding: 10px; 
      text-align: center; 
    }
    th { 
      background-color: #f2f2f2; 
    }
    canvas { 
      width: 100% !important; 
      height: 200px !important; 
      margin-top: 20px; 
    }
    #countdown { 
      font-size: 24px; 
      color: red; 
      margin-top: 10px; 
    }
    .content {
      flex: 1; /* Ph·∫ßn c√≤n l·∫°i chi·∫øm to√†n b·ªô kh√¥ng gian */
    }
    h2 {
      text-align: center; /* CƒÉn gi·ªØa ti√™u ƒë·ªÅ */
    }
    #questionImage {
      width: 100%;
      height: auto;
      margin-top: 20px;
      border: 1px solid #ccc;
      max-width: 600px; /* Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc h√¨nh ·∫£nh */
    }
  </style>
</head>
<body>

<h2>üìãƒêi·ªÅu khi·ªÉn & K·∫øt qu·∫£</h2>

<div style="display: flex; gap: 40px;">
  <div id="questionButtons"></div>

  <div class="content">
    <p>Ch·ªçn c√¢u ƒë·ªÉ b·∫Øt ƒë·∫ßu:</p>
    <h3>‚è±Ô∏è C√≤n l·∫°i: <span id="countdown">‚Äî</span></h3>

    <h3>K·∫øt qu·∫£ c√¢u <span id="currentQ">‚Äî</span>:</h3>
    <table>
      <thead>
        <tr><th>H·ªçc sinh</th><th>C√¢u</th><th>ƒê√°p √°n</th><th>ƒêi·ªÉm</th></tr>
      </thead>
      <tbody id="resultsBody">
        <tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>
      </tbody>
    </table>

    <h3>Bi·ªÉu ƒë·ªì t·ªïng ƒëi·ªÉm</h3>
    <canvas id="scoreChart"></canvas>

    <br>
    <button style="background-color: red;" onclick="resetGame()">üîÑ Reset d·ªØ li·ªáu</button>

    <!-- H√¨nh ·∫£nh c√¢u h·ªèi -->
    <div id="questionImageContainer">
      <img id="questionImage" src="" alt="C√¢u h·ªèi h√¨nh ·∫£nh s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y">
    </div>
  </div>
</div>

<script>
  // Firebase setup
  const cfg = {
    apiKey: "AIzaSyB-ST5U4VSxraEGKl3INjGKKdl9Dik5bg0",
    authDomain: "giaiphong2025-697c5.firebaseapp.com",
    databaseURL: "https://giaiphong2025-697c5-default-rtdb.firebaseio.com",
    projectId: "giaiphong2025-697c5",
    storageBucket: "giaiphong2025-697c5.appspot.com",
    messagingSenderId: "205746810625",
    appId: "1:205746810625:web:ec05b354a6221f7b3af500"
  };
  firebase.initializeApp(cfg);
  const db = firebase.database();

  // ƒë√°p √°n ƒë√∫ng
  const correct = {1:'A',2:'B',3:'C',4:'D',5:'A',6:'B',7:'C',8:'D',9:'A',10:'B'};

  // UI refs
  const questionContainer = document.getElementById("questionButtons");
  const countdownEl = document.getElementById("countdown");
  const currentQEl  = document.getElementById("currentQ");
  const resultsBody = document.getElementById("resultsBody");
  const ctx = document.getElementById("scoreChart").getContext("2d");
  const questionImage = document.getElementById("questionImage");
  let barChart = null;

  // t·∫°o n√∫t 1‚Äì10
  for(let i=1;i<=10;i++){
    const b=document.createElement("button");
    b.innerText="‚ñ∂Ô∏è C√¢u "+i;
    b.id="q"+i;
    b.onclick=()=>startQuestion(i);
    questionContainer.appendChild(b);
  }

  let countdownInt, curQ=null;

  function startQuestion(n){
    // clear b·∫£ng c≈©
    resultsBody.innerHTML=`<tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>`;
    // highlight n√∫t
    document.querySelectorAll("#questionButtons button")
      .forEach(x=>x.classList.remove("selected"));
    document.getElementById("q"+n).classList.add("selected");
    // set hi·ªán question & reset ƒë·ªìng h·ªì
    curQ=n; currentQEl.innerText=n;
    startCountdown(30);
    // Thay ƒë·ªïi h√¨nh ·∫£nh
    questionImage.src = `images/C0${n}.png`;
    // th√¥ng b√°o cho student
    db.ref("currentQuestion").set({number:n,ts:Date.now()});
  }

  function startCountdown(sec){
    clearInterval(countdownInt);
    let t=sec;
    countdownEl.innerText=`${t}s`;
    countdownInt=setInterval(()=>{
      t--; countdownEl.innerText=`${t}s`;
      if(t<=0){
        clearInterval(countdownInt);
        countdownEl.innerText="0s";
      }
    },1000);
  }

  // l·∫Øng nghe answers realtime
  db.ref("answers").on("value",snap=>{
    const data=snap.val()||{};
    // c·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì t·ªïng ƒëi·ªÉm
    const names=Object.keys(data), pts=names.map(u=>{
      let sum=0;
      for(const k in data[u]){
        const qn=+k.replace("cau","");
        if(data[u][k]===correct[qn]) sum+=3;
      }
      return sum;
    });
    // color array
    const colors=names.map(_=>'#'+Math.floor(Math.random()*0xFFFFFF).toString(16));
    if(barChart) barChart.destroy();
    barChart=new Chart(ctx,{type:'bar',
      data:{labels:names,datasets:[{data:pts,backgroundColor:colors,borderColor:colors,borderWidth:1}]},
      options:{responsive:true,scales:{y:{beginAtZero:true,max:30}},plugins:{legend:{display:false}}}
    });
    // n·∫øu ƒëang xem 1 c√¢u, c·∫≠p nh·∫≠t lu√¥n b·∫£ng c√¢u ƒë√≥
    if(curQ){
      const rows=names.map(u=>{
        const ans=(data[u]['cau'+curQ]||'');
        const sc=(ans===correct[curQ]?3:0);
        return `<tr><td>${u}</td><td>${curQ}</td><td>${ans}</td><td>${sc}</td></tr>`;
      });
      resultsBody.innerHTML=rows.length?rows.join(""):`<tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>`;
    }
  });

  function resetGame(){
    if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu?")){
      db.ref("answers").remove();
      db.ref("currentQuestion").remove();
      clearInterval(countdownInt);
      countdownEl.innerText="‚Äî";
      currentQEl.innerText="‚Äî";
      resultsBody.innerHTML=`<tr><td colspan="4">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>`;
      document.querySelectorAll("#questionButtons button").forEach(x=>x.classList.remove("selected"));
      if(barChart)barChart.destroy();
      questionImage.src = ""; // Reset h√¨nh ·∫£nh
    }
  }
</script>

</body>
</html>
