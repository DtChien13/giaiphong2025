<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Gi√°o vi√™n ƒëi·ªÅu khi·ªÉn</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body { 
      background-image: url('images/'); /* H√¨nh n·ªÅn */
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex;
      gap: 20px;
    }
    #questionList {
      width: 180px;
    }
    #questionList button {
      width: 100%;
      padding: 12px;
      margin-bottom: 8px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s;
    }
    #questionList button.active {
      background-color: #e74c3c;
    }
    #questionList button.selected {
      background-color: #e74c3c;
    }
    #mainArea {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    #controlPanel {
      margin-bottom: 20px;
      width: 100%;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    #controlPanel button {
      padding: 10px 20px;
      background-color: #e67e22;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    #currentQuestionInfo {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
    }
    #countdown {
      font-size: 24px;
      color: red;
      margin: 10px 0;
    }
    #questionImage {
      width: 600px;
      max-width: 90%;
      border: 2px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
      display: block;
    }
    #resultArea {
      width: 100%;
      padding-bottom: 50px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f7f7f7;
    }
    #resetButtonContainer {
      position: absolute;
      bottom: 0;
      right: 0;
      padding: 10px;
    }
    #resetButtonContainer button {
      padding: 8px 16px;
      font-size: 14px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #resetButtonContainer button:hover {
      background-color: #c0392b;
    }
    #teamScores {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 0;
    }
    .teamBox {
      width: 3cm;
      padding: 10px;
      background-color: #f1f1f1;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      font-weight: bold;
    }
    .mediaDisplay {
      width: 600px;
      max-width: 90%;
      border: 2px solid #ccc;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    #totalScore {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
      color: green;
    }
  </style>
</head>
<body>

<div id="questionList">
  <h3>C√¢u h·ªèi</h3>
</div>

<div id="mainArea">
   <img src="images/banner.png" style="width: 90%; height: auto;">

  <div id="controlPanel">
    <button onclick="openExplain(1)">üìñ Gi·∫£i th√≠ch 1</button>
    <button onclick="openExplain(2)">üìñ Gi·∫£i th√≠ch 2</button>
    <button onclick="openExplain(3)">üìñ Gi·∫£i th√≠ch 3</button>
    <button onclick="openExplain(4)">üìñ Gi·∫£i th√≠ch 4</button>
  </div>

  <div id="currentQuestionInfo">
    <div id="countdown">‚è±Ô∏è C√≤n l·∫°i: ‚Äî</div>
    <img id="questionImage" src="" alt="H√¨nh c√¢u h·ªèi">
  </div>

  <div id="resultArea">
    <h3>üìã K·∫øt qu·∫£ tr·∫£ l·ªùi:</h3>
    <table>
      <thead>
        <tr>
          <th>üë§ Nh√≥m</th>
          <th>üÖ∞Ô∏è Ph∆∞∆°ng √°n</th>
          <th>üèÜ ƒêi·ªÉm</th>
        </tr>
      </thead>
      <tbody id="answerList"></tbody>
    </table>
  </div>

  <div id="resetButtonContainer">
    <button onclick="resetSystem()">üîÑ Reset</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB-ST5U4VSxraEGKl3INjGKKdl9Dik5bg0",
  authDomain: "giaiphong2025-697c5.firebaseapp.com",
  databaseURL: "https://giaiphong2025-697c5-default-rtdb.firebaseio.com",
  projectId: "giaiphong2025-697c5",
  storageBucket: "giaiphong2025-697c5.appspot.com",
  messagingSenderId: "205746810625",
  appId: "1:205746810625:web:ec05b354a6221f7b3af500"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const questionListEl = document.getElementById("questionList");
const questionImage = document.getElementById("questionImage");
const countdownEl = document.getElementById("countdown");
const answerListEl = document.getElementById("answerList");
const totalScoreEl = document.getElementById("totalScore");

let countdownInt = null;
let currentQuestion = null;

const correctAnswers = {
  cau1: "B", cau2: "C", cau3: "C", cau4: "D", cau5: "B",
  cau6: "D", cau7: "A", cau8: "D", cau9: "A", cau10: "D"
};

let studentAnswers = {};
let teamScores = { team1: 0, team2: 0 };

for (let i = 1; i <= 10; i++) {
  const btn = document.createElement("button");
  btn.textContent = "C√¢u " + i;
  btn.onclick = () => startQuestion(i, btn);
  questionListEl.appendChild(btn);
}

function startQuestion(qn, btn) {
  clearInterval(countdownInt);
  currentQuestion = qn;

  const padded = String(qn).padStart(2, '0');
  const imgPath = `./images/C${padded}.png`;

  db.ref("currentQuestion").set({ number: qn });
  answerListEl.innerHTML = "";

  document.querySelectorAll("#questionList button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  document.querySelectorAll("#questionList button").forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");

  questionImage.style.display = "block";
  questionImage.src = imgPath;
  startCountdown(qn === 1 ? 90 : 30);
}

function resetSystem() {
  clearInterval(countdownInt);
  countdownEl.innerText = "‚è±Ô∏è C√≤n l·∫°i: ‚Äî";  // Reset countdown

  db.ref("currentQuestion").remove();
  db.ref("answers").remove();
  db.ref("studentChoices").remove();
  db.ref("teacherChoices").remove();
  db.ref("resetSignal").set(Date.now());

  questionImage.src = "";
  answerListEl.innerHTML = "";
  totalScoreEl.innerHTML = "üéØ T·ªïng ƒëi·ªÉm: 0";

  document.querySelectorAll("#questionList button").forEach(b => b.classList.remove("active"));
  document.querySelectorAll("#questionList button").forEach(b => b.classList.remove("selected"));

  disableStudentChoices(true);

  studentAnswers = {};
  teamScores = { team1: 0, team2: 0 };

  alert("ƒê√£ reset to√†n b·ªô h·ªá th·ªëng!");
}

function disableStudentChoices(disable) {
  const studentButtons = document.querySelectorAll(".student-choice-button");
  studentButtons.forEach(button => {
    button.disabled = disable;
  });
}

function startCountdown(sec) {
  let t = sec;
  countdownEl.innerText = `‚è±Ô∏è ${t}s`;
  countdownInt = setInterval(() => {
    t--;
    countdownEl.innerText = `‚è±Ô∏è ${t}s`;
    if (t <= 0) {
      clearInterval(countdownInt);
      countdownEl.innerText = "‚è±Ô∏è 0s";
      loadAnswers();
    }
  }, 1000);
}

function loadAnswers() {
  if (!currentQuestion) return;

  db.ref("answers").once("value", snap => {
    const data = snap.val();
    answerListEl.innerHTML = "";

    if (data) {
      const studentScores = {};

      for (const name in data) {
        const answers = data[name];
        const ansKey = "cau" + currentQuestion;
        let studentAnswer = answers[ansKey] || "";

        studentAnswer = studentAnswer.toString().trim().toUpperCase();
        if (!["A", "B", "C", "D"].includes(studentAnswer)) {
          studentAnswer = "Kh√¥ng ch·ªçn";
        }

        const row = document.createElement("tr");
        row.innerHTML = `<td>${name}</td><td>${studentAnswer}</td><td>1</td>`;
        answerListEl.appendChild(row);

        studentScores[name] = 1;
      }

      updateTeamScores(studentScores);
    }
  });
}

function updateTeamScores(studentScores) {
  const team1Score = Object.values(studentScores).reduce((total, score) => total + score, 0);
  const team2Score = Object.values(studentScores).reduce((total, score) => total + score, 0);

  totalScoreEl.innerHTML = `üéØ T·ªïng ƒëi·ªÉm: Team1: ${team1Score}, Team2: ${team2Score}`;
}
</script>
</body>
</html>
