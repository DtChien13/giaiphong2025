<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒêi·ªÅu khi·ªÉn & K·∫øt qu·∫£</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; display: flex; }
    #sidebar {
      width: 180px; padding: 10px;
      border-right: 2px solid #ccc;
    }
    #sidebar button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #sidebar button.selected {
      background-color: #ff9800;
    }
    #content {
      flex: 1;
      padding: 20px;
      text-align: center;
    }
    table {
      margin: 10px auto;
      border-collapse: collapse;
      width: 90%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    img {
      max-width: 100%;
      width: auto;
      height: auto;
      margin: 0 auto;
      display: block;
      border: 2px solid #aaa;
      border-radius: 8px;
    }
    canvas { width: 90% !important; height: 300px !important; }
  </style>
</head>
<body>

<!-- Banner -->
<div style="text-align: center; margin-bottom: 20px;">
  <img src="images/banner.png" alt="Banner" style="max-width: 60%; width: auto; height: auto; margin: 0 auto; display: block;">
</div>

<div id="sidebar">
  <h3>üõ†Ô∏è C√¢u h·ªèi</h3>
  <div id="questionButtons"></div>
  <button style="background-color: red; margin-top: 20px;" onclick="resetGame()">üîÑ Reset</button>
</div>

<div id="content">
 
  <h1>‚è±Ô∏è <span id="countdown">‚Äî</span> | C√¢u h·ªèi: <span id="currentQ">‚Äî</span></h1>
  <img id="questionImage" src="" alt="">
  <h3>K·∫øt qu·∫£ c√¢u <span id="currentQ2">‚Äî</span>:</h3>
  <table>
    <thead>
      <tr><th>H·ªçc sinh</th><th>ƒê√°p √°n</th><th>ƒêi·ªÉm</th></tr>
    </thead>
    <tbody id="resultsBody">
      <tr><td colspan="3">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>
    </tbody>
  </table>
  <h3>Bi·ªÉu ƒë·ªì ƒëi·ªÉm</h3>
  <canvas id="scoreChart"></canvas>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyB-ST5U4VSxraEGKl3INjGKKdl9Dik5bg0",
    authDomain: "giaiphong2025-697c5.firebaseapp.com",
    databaseURL: "https://giaiphong2025-697c5-default-rtdb.firebaseio.com",
    projectId: "giaiphong2025-697c5",
    storageBucket: "giaiphong2025-697c5.appspot.com",
    messagingSenderId: "205746810625",
    appId: "1:205746810625:web:ec05b354a6221f7b3af500"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const correct = {1:'B',2:'C',3:'C',4:'D',5:'B',6:'D',7:'A',8:'D',9:'A',10:'D'};

  const sidebar = document.getElementById("questionButtons");
  const countdownEl = document.getElementById("countdown");
  const currentQEl = document.getElementById("currentQ");
  const currentQ2El = document.getElementById("currentQ2");
  const resultsBody = document.getElementById("resultsBody");
  const ctx = document.getElementById("scoreChart").getContext("2d");
  const questionImage = document.getElementById("questionImage");

  let barChart = null;
  let countdownInt = null;
  let curQ = null;

  for (let i = 1; i <= 10; i++) {
    const btn = document.createElement("button");
    btn.textContent = "‚ñ∂Ô∏è C√¢u " + i;
    btn.id = "q" + i;
    btn.onclick = () => startQuestion(i);
    sidebar.appendChild(btn);
  }

  function startQuestion(n) {
    curQ = n;
    db.ref("currentQuestion").set({number: n, ts: Date.now()});
    const padded = String(n).padStart(2, '0');
  questionImage.src = `./images/C${padded}.png`; // Them ·∫£nh
  

    currentQEl.innerText = n;
    currentQ2El.innerText = n;
    resultsBody.innerHTML = `<tr><td colspan="3">ƒêang ch·ªù h·ªçc sinh...</td></tr>`;
    startCountdown(30);
    document.querySelectorAll("#sidebar button").forEach(b => b.classList.remove("selected"));
    document.getElementById("q" + n).classList.add("selected");
  }

  function startCountdown(sec) {
    clearInterval(countdownInt);
    let t = sec;
    countdownEl.innerText = `${t}s`;
    countdownInt = setInterval(() => {
      t--;
      countdownEl.innerText = `${t}s`;
      if (t <= 0) {
        clearInterval(countdownInt);
        countdownEl.innerText = "0s";
        updateResult();
      }
    }, 1000);
  }

  function updateResult() {
    db.ref("answers").once("value").then(snap => {
      const data = snap.val() || {};
      const names = Object.keys(data);
      const rows = names.map(u => {
        const ans = (data[u]["cau"+curQ] || "");
        const sc = (ans === correct[curQ]) ? 3 : 0;
        return `<tr><td>${u}</td><td>${ans}</td><td>${sc}</td></tr>`;
      });
      resultsBody.innerHTML = rows.length ? rows.join("") : `<tr><td colspan="3">Kh√¥ng c√≥ d·ªØ li·ªáu.</td></tr>`;
      updateChart(data);
    });
  }

  function updateChart(data) {
    const names = Object.keys(data);
    const pts = names.map(u => {
      let sum = 0;
      for (const k in data[u]) {
        const qn = +k.replace("cau", "");
        if (data[u][k] === correct[qn]) sum += 3;
      }
      return sum;
    });
    const colors = names.map(_ => '#' + Math.floor(Math.random() * 0xFFFFFF).toString(16));
    if (barChart) barChart.destroy();
    barChart = new Chart(ctx, {
      type: 'bar',
      data: {labels: names, datasets: [{data: pts, backgroundColor: colors}]},
      options: {responsive: true, scales: {y: {beginAtZero: true, max: 30}}}
    });
  }

function resetGame() {
  if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën reset?")) {
    // X√≥a d·ªØ li·ªáu c√¢u h·ªèi hi·ªán t·∫°i
    db.ref("currentQuestion").remove();
    // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu ƒë√°p √°n c·ªßa h·ªçc sinh
    db.ref("answers").remove();
    // ƒê·∫∑t l·∫°i c√°c th√¥ng tin hi·ªÉn th·ªã
    clearInterval(countdownInt);
    countdownEl.innerText = "‚Äî";
    currentQEl.innerText = "‚Äî";
    currentQ2El.innerText = "‚Äî";
    questionImage.src = "";
    resultsBody.innerHTML = `<tr><td colspan="3">Ch∆∞a c√≥ d·ªØ li·ªáu...</td></tr>`;
    // X√≥a bi·ªÉu ƒë·ªì ƒëi·ªÉm
    if (barChart) barChart.destroy();
    // G·ª° b·ªè l·ª±a ch·ªçn c√¢u h·ªèi ƒë√£ ch·ªçn
    document.querySelectorAll("#sidebar button").forEach(b => b.classList.remove("selected"));
    // X√≥a t√™n h·ªçc sinh trong localStorage
    localStorage.removeItem("name");
  }
}


</script>
<div style="margin-top: 20px; display: flex; justify-content: flex-end;">
  <div style="background-color: #f0f8ff; padding: 8px; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: flex-end; max-width: 160px; width: 100%;">
    <button onclick="window.open('gioithieu1.html', '_blank');" style="padding: 4px 8px; font-size: 10px; background-color: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 8px; width: 100%;">
      ‚ÑπÔ∏è Gi·ªõi thi·ªáu 1
    </button>
    <button onclick="window.open('gioithieu2.html', '_blank');" style="padding: 4px 8px; font-size: 10px; background-color: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; margin-bottom: 8px; width: 100%;">
      ‚ÑπÔ∏è Gi·ªõi thi·ªáu 2
    </button>
    <button onclick="window.open('gioithieu3.html', '_blank');" style="padding: 4px 8px; font-size: 10px; background-color: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%;">
      ‚ÑπÔ∏è Gi·ªõi thi·ªáu 3
    </button>
  </div>
</div>

<style>
@media (max-width: 600px) {
  div[style*="display: flex; justify-content: flex-end;"] {
    justify-content: center;
  }
  div[style*="background-color: #f0f8ff;"] {
    align-items: center;
    max-width: 80%;
  }
}
</style>


</body>
</html>

